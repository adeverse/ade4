<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ade4">
<title>Taking into account groups of sites • ade4</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Taking into account groups of sites">
<meta property="og:description" content="ade4">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ade4</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.7-22</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-new-to-ade-">New to ade4?</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-new-to-ade-">
    <a class="dropdown-item" href="../articles/install.html">Installation</a>
    <a class="dropdown-item" href="../articles/get_started.html">Getting started</a>
  </div>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-vignettes">Vignettes</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-vignettes">
    <a class="external-link dropdown-item" href="https://cran.r-project.org/web/packages/adegraphics/vignettes/adegraphics.html">Graphical representation of multivariate data</a>
    <a class="dropdown-item" href="../articles/ChapEnvVarStruct.html">Environmental variables structures</a>
    <a class="dropdown-item" href="../articles/ChapSpeciesStruct.html">Species structures</a>
    <a class="dropdown-item" href="../articles/ChapBetGr.html">Taking into account groups of sites</a>
    <a class="dropdown-item" href="../articles/Chap2tables.html">Description of species-environment relationships</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/related.html">Related packages</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-ressources">Ressources</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-ressources">
    <a class="external-link dropdown-item" href="https://lbbe-shiny.univ-lyon1.fr/Reproducible_Research/ShinyADE4/">ade4 shinyapps</a>
    <a class="dropdown-item" href="../articles/faq.html">FAQ</a>
    <a class="external-link dropdown-item" href="https://listes.univ-lyon1.fr/sympa/info/adelist">adelist</a>
    <a class="dropdown-item" href="../articles/book.html">ade4 book</a>
    <a class="dropdown-item" href="../articles/papers.html">Papers</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://lbbe-web.univ-lyon1.fr/en">
    <span class="fa fa-leaf"></span>
     
    LBBE
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/sdray/ade4">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Taking into account groups of sites</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sdray/ade4/blob/HEAD/vignettes/articles/ChapBetGr.Rmd" class="external-link"><code>vignettes/articles/ChapBetGr.Rmd</code></a></small>
      <div class="d-none name"><code>ChapBetGr.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="abstract">Abstract<a class="anchor" aria-label="anchor" href="#abstract"></a>
</h2>
<p>This vignette shows how the partitioning of sites can be taken into
account during the analysis of an ecological data table. We present the
Between-Class and Within-Class Analyses and Discriminant Analysis. Then
we present several examples of use of these methods on a small data set
with simple structures. The vignette ends with a comparison between
Discriminant Analysis and Between-Class Analysis.</p>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Taking into account the existence of groups of sites (or
<code>samples</code>) is achieved by decomposing a data table into two
additive components. The first relates to the differences between groups
and its analysis aims to describe the main characteristics of the
groups. The second component contains only within-groups variations and
its analysis focuses on the characteristics of the residuals (i.e., the
data variability if groups did not exist).</p>
<p>Groups are to be taken here in a very broad sense. They can, for
example, represent space-time structures, like sites belonging to the
same geographic region, or to the same period of time. They can also
correspond to an experimental design, with groups representing different
treatments. One of the advantages of the duality diagram framework used
in the <strong>ade4</strong> package is that all the simple methods that
have been described in the vignette <em>Description of environmental
variables structures</em> and <em>Description of species structures</em>
can be used here, which means that the effect of groups can be analysed
in any type of data table (quantitative, qualitative or mixed tables,
counts, presence/absence, row percentages, etc.).</p>
<p>Two types of analyses, called Between-Class and Within-Class Analysis
are implemented in <strong>ade4</strong>. The corresponding generic
functions are named <code>bca</code> (formerly <code>between</code>) and
<code>wca</code> (formerly <code>within</code>) and several methods are
provided:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://pbil.univ-lyon1.fr/ADE-4/" class="external-link">ade4</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://pbil.univ-lyon1.fr/ADE-4/" class="external-link">adegraphics</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/methods.html" class="external-link">methods</a></span><span class="op">(</span><span class="va">bca</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] bca.coinertia* bca.dpcoa*     bca.dudi*      bca.rlq*      </span></span>
<span><span class="co">#&gt; see '?methods' for accessing help and source code</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/methods.html" class="external-link">methods</a></span><span class="op">(</span><span class="va">wca</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] wca.coinertia* wca.dpcoa*     wca.dudi*      wca.rlq*      </span></span>
<span><span class="co">#&gt; see '?methods' for accessing help and source code</span></span></code></pre>
<p>Between-Class Analysis models the differences between groups by
computing the group means, and the resulting means table is then
analysed. Conversely, Within-Class Analysis removes the group effect by
computing the residuals between observed data and group means, and
analyses the table of these differences.</p>
<p>The first analysis can be used to visually check the existence of
groups, to describe the main characteristics of the differences between
the groups (for example, which variables are best related to which
groups?), and to test their statistical significance using a permutation
test. The second one tries to find out wether other structures remain in
the data table that can be revealed after removing a strong group
effect.</p>
</div>
<div class="section level2">
<h2 id="an-environmental-situation">An environmental situation<a class="anchor" aria-label="anchor" href="#an-environmental-situation"></a>
</h2>
<p>We have already used the <code>meaudret</code> data set in other
vignettes. In this vignette, we use the <code>meau</code> data set which
has been used to illustrate the first description of Between-Class and
Within-Class Analyses (Doledec, 1987).</p>
<p>Both data sets contain the same kind of data, physico-chemical
parameters measured four times (four seasons) at several sites along a
small stream called the Méaudret (South-East of France). But in the
<code>meaudret</code> data set, the <code>oxygen</code> variable has
been removed because it takes the same values in all the sampling sites
during winter. This can cause an error in some situations (particularly
in multiway analyses). The <code>meaudret$env</code> data frame
therefore contains only nine variables, while the <code>meau$env</code>
data frame contains 10 variables. The second difference is the fact that
the <code>meaudret</code> data set gives the results of five sampling
sites, while the <code>meau</code> data set includes a sixth site. This
site is located on another stream, the Bourne river, into which the
Méaudret flows. It can be used as a control site, as it is situated
upstream the Méaudret and Bourne confluence.</p>
<p>The <code>meau$env</code> data frame therefore has 24 rows and 10
columns:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://pbil.univ-lyon1.fr/ADE-4/" class="external-link">ade4</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://pbil.univ-lyon1.fr/ADE-4/" class="external-link">adegraphics</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">meau</span><span class="op">)</span></span>
<span><span class="va">env</span> <span class="op">&lt;-</span> <span class="va">meau</span><span class="op">$</span><span class="va">env</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 24 10</span></span></code></pre>
<p>The 10 columns correspond to 10 environmental variables: water
temperature, flow, pH, conductivity, oxygen, biological oxygen demand
(BDO5), oxydability, ammonium, nitrates, and phosphorus.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;  [1] "Temp" "Flow" "pH"   "Cond" "Oxyg" "Bdo5" "Oxyd" "Ammo"</span></span>
<span><span class="co">#&gt;  [9] "Nitr" "Phos"</span></span></code></pre>
<p>The 24 rows correspond to the six sites, sampled four times
(<code>sp</code> = spring, <code>su</code> = summer, <code>au</code> =
autumn, and <code>wi</code> = winter):</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;  [1] "sp_1" "sp_2" "sp_3" "sp_4" "sp_5" "sp_6" "su_1" "su_2"</span></span>
<span><span class="co">#&gt;  [9] "su_3" "su_4" "su_5" "su_6" "au_1" "au_2" "au_3" "au_4"</span></span>
<span><span class="co">#&gt; [17] "au_5" "au_6" "wi_1" "wi_2" "wi_3" "wi_4" "wi_5" "wi_6"</span></span></code></pre>
<p>The <code>meau</code> data set also contains the description of the
sampling design coded as two categorical variables
(<code>factor</code>):</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">seasons</span> <span class="op">&lt;-</span> <span class="va">meau</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">season</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;  [1] spring spring spring spring spring spring summer summer</span></span>
<span><span class="co">#&gt;  [9] summer summer summer summer autumn autumn autumn autumn</span></span>
<span><span class="co">#&gt; [17] autumn autumn winter winter winter winter winter winter</span></span>
<span><span class="co">#&gt; Levels: spring summer autumn winter</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">sites</span> <span class="op">&lt;-</span> <span class="va">meau</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">site</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;  [1] S1 S2 S3 S4 S5 S6 S1 S2 S3 S4 S5 S6 S1 S2 S3 S4 S5 S6</span></span>
<span><span class="co">#&gt; [19] S1 S2 S3 S4 S5 S6</span></span>
<span><span class="co">#&gt; Levels: S1 S2 S3 S4 S5 S6</span></span></code></pre>
<p>The aim of the study is to analyse the variations of physico-chemical
parameters along the stream and during the year (spatial and temporal
components). We first apply a normed PCA on the environmental data
table.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">envpca</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dudi.pca.html">dudi.pca</a></span><span class="op">(</span><span class="va">env</span>, scannf <span class="op">=</span> <span class="cn">FALSE</span>, nf <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Duality diagramm</span></span>
<span><span class="co">#&gt; class: pca dudi</span></span>
<span><span class="co">#&gt; $call: dudi.pca(df = env, scannf = FALSE, nf = 3)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $nf: 3 axis-components saved</span></span>
<span><span class="co">#&gt; $rank: 10</span></span>
<span><span class="co">#&gt; eigen values: 5.745 1.43 1.084 0.6761 0.5244 ...</span></span>
<span><span class="co">#&gt;   vector length mode    content       </span></span>
<span><span class="co">#&gt; 1 $cw    10     numeric column weights</span></span>
<span><span class="co">#&gt; 2 $lw    24     numeric row weights   </span></span>
<span><span class="co">#&gt; 3 $eig   10     numeric eigen values  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   data.frame nrow ncol content             </span></span>
<span><span class="co">#&gt; 1 $tab       24   10   modified array      </span></span>
<span><span class="co">#&gt; 2 $li        24   3    row coordinates     </span></span>
<span><span class="co">#&gt; 3 $l1        24   3    row normed scores   </span></span>
<span><span class="co">#&gt; 4 $co        10   3    column coordinates  </span></span>
<span><span class="co">#&gt; 5 $c1        10   3    column normed scores</span></span>
<span><span class="co">#&gt; other elements: cent norm</span></span></code></pre>
<p>The following figure shows the PCA of the Méaudret environmental data
table. The correlation circle shows that the first axis corresponds to a
pollution gradient, with high levels of pollution toward the right and
absence of pollution on the left. The second axis is a temperature and
flow gradient and underlines the particular behaviour of nitrates
(compared to other pollution parameters). The analysis of the sites
factor map is not easy, as many labels are superimposed, and spatial and
temporal structures are mixed.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/s.corcircle.html">s.corcircle</a></span><span class="op">(</span><span class="va">envpca</span><span class="op">$</span><span class="va">co</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">g2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/s.label.html">s.label</a></span><span class="op">(</span><span class="va">envpca</span><span class="op">$</span><span class="va">li</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/adegraphics/man/ADEgS.html" class="external-link">ADEgS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">g1</span>, <span class="va">g2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="ChapBetGr_files/figure-html/unnamed-chunk-9-1.png" width="600" height="300"></p>
<p>Correlation matrix PCA of the Méaudret environmental data table.
Left: correlation circle, right: sites factor map.</p>
<p>Interpretation is easier on the next figure, where the four seasons
are grouped using a star and an ellipse for each site. It is easy to see
that site 2 is more polluted than the others (because it is located on
the right of the figure). Sites 3, 4 and 5 are less and less polluted,
and site 5 is in fact comparable to site 1. Site 6 (control site located
on the Bourne river) is on the left of site 1, denoting even lower
levels of chemical pollution.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/s.class.html">s.class</a></span><span class="op">(</span><span class="va">envpca</span><span class="op">$</span><span class="va">li</span>, <span class="va">meau</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">site</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span>, col <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="ChapBetGr_files/figure-html/unnamed-chunk-10-1.png" width="600" height="300"></p>
<p>PCA sites factor map, with the four samples grouped for each
site.</p>
<p>The next figure shows the same factor map, with the six sampling
sites grouped for each season, but the temporal structure is less easy
to interpret than the succession of the six sites along the stream.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/s.class.html">s.class</a></span><span class="op">(</span><span class="va">envpca</span><span class="op">$</span><span class="va">li</span>, <span class="va">meau</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">season</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span>, col <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="ChapBetGr_files/figure-html/unnamed-chunk-11-1.png" width="600" height="300"></p>
<p>PCA sites factor map, with the six sampling sites grouped for each
season.</p>
<p>Here, we show that applying a simple PCA and then using graphical
functions allows to display differences among sites or seasons. However,
this approach is not optimal. Indeed, the spatial structures can be
analysed by computing the mean of the four dates for all the parameters
(between-sites analysis), and conversely the temporal structures can be
assessed by computing the mean of the six sites (between-dates
analysis). It is also possible to try to remove the spatial effect using
a within-site analysis and see if temporal structures appear more
clearly.</p>
</div>
<div class="section level2">
<h2 id="between-class-analysis-analysing-differences-between-groups">Between-Class Analysis: analysing differences between groups<a class="anchor" aria-label="anchor" href="#between-class-analysis-analysing-differences-between-groups"></a>
</h2>
<p>Between-Class Analyses (Doledec 1987, Culhane 2002} are methods to
separate groups of sites, given a set of variables. There are several
types of Between-Class Analyses, corresponding to the initial analysis
after which Between-Class Analysis is computed (<em>e.g.</em>, Principal
Component Analysis, Correspondence Analysis, or Multiple Correspondence
Analysis).</p>
<p>BCA is the analysis of a table of group means. The main function to
compute a Between-Class Analysis in the <strong>ade4</strong> package is
the <code>bca</code> function. All the outputs of this function are
grouped in a <code>dudi</code> object (subclass
<code>between</code>).</p>
<p>The <code>bca</code> function takes two main arguments: an analysis
of the initial table (a <code>dudi</code> object) and a categorical
variable (an object of class <code>factor</code>). In
<strong>ade4</strong>, the user must first perform a simple analysis to
identify the main variations in the data table and then use the
<code>bca</code> function to introduce the partitioning in groups. This
two-step implementation has a pedagogical aim by forcing users to
interpret simple structures before analysing differences among groups.
The outputs of both analyses can then be compared to evaluate the role
of the categorical variable. The last two arguments (<code>scannf</code>
and <code>nf</code>) have the same meaning as in the other analysis
functions.</p>
<p>Between-Class Analysis is a particular case of analysis on
instrumental variables when only one explanatory categorical variable is
considered. The main advantage to use <code>bca</code> function is that
several methods (<code>plot</code>, <code>summary</code>) are optimised
to summarize the results of the analysis.</p>
<div class="section level3">
<h3 id="between-site-analysis">Between-site analysis<a class="anchor" aria-label="anchor" href="#between-site-analysis"></a>
</h3>
<p>As explained at the begining of this chapter, a Between-Class
Analysis is the analysis of the table of class means. So the
between-site analysis is the analysis of the table of site means. The
between-site analysis <code>betsite</code> is computed using the
<code>bca</code> function, and the table of site means is stored in the
<code>betsite$tab</code> data frame. We can check that the dimensions of
the <code>betsite$tab</code> data frame are six rows (six sites) and 10
columns (10 physico-chemical parameters), and that the mean of the
standardised temperature in site 1 during the four seasons is equal to
-0.1834:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">betsite</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bca.html">bca</a></span><span class="op">(</span><span class="va">envpca</span>, <span class="va">sites</span>, scannf <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">betsite</span><span class="op">$</span><span class="va">tab</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1]  6 10</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">betsite</span><span class="op">$</span><span class="va">tab</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;            Temp       Flow         pH       Cond</span></span>
<span><span class="co">#&gt; S1 -0.183449013 -0.9965745  0.1162958 -0.2449490</span></span>
<span><span class="co">#&gt; S2 -0.039880220 -0.4293031 -0.8805250  1.1022704</span></span>
<span><span class="co">#&gt; S3  0.007976044 -0.1724604 -0.3821146  0.5817538</span></span>
<span><span class="co">#&gt;           Oxyg</span></span>
<span><span class="co">#&gt; S1  0.39460259</span></span>
<span><span class="co">#&gt; S2 -1.56390293</span></span>
<span><span class="co">#&gt; S3 -0.06673426</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">envpca</span><span class="op">$</span><span class="va">tab</span><span class="op">$</span><span class="va">Temp</span><span class="op">[</span><span class="va">sites</span> <span class="op">==</span> <span class="st">"S1"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] -0.183449</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">betsite</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Between analysis</span></span>
<span><span class="co">#&gt; call: bca.dudi(x = envpca, fac = sites, scannf = FALSE)</span></span>
<span><span class="co">#&gt; class: between dudi </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $nf (axis saved) : 2</span></span>
<span><span class="co">#&gt; $rank:  5</span></span>
<span><span class="co">#&gt; $ratio:  0.4412974</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; eigen values: 3.335 0.6156 0.4027 0.04589 0.01407</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   vector length mode    content      </span></span>
<span><span class="co">#&gt; 1 $eig   5      numeric eigen values </span></span>
<span><span class="co">#&gt; 2 $lw    6      numeric group weigths</span></span>
<span><span class="co">#&gt; 3 $cw    10     numeric col weigths  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   data.frame nrow ncol content                       </span></span>
<span><span class="co">#&gt; 1 $tab       6    10   array class-variables         </span></span>
<span><span class="co">#&gt; 2 $li        6    2    class coordinates             </span></span>
<span><span class="co">#&gt; 3 $l1        6    2    class normed scores           </span></span>
<span><span class="co">#&gt; 4 $co        10   2    column coordinates            </span></span>
<span><span class="co">#&gt; 5 $c1        10   2    column normed scores          </span></span>
<span><span class="co">#&gt; 6 $ls        24   2    row coordinates               </span></span>
<span><span class="co">#&gt; 7 $as        3    2    inertia axis onto between axis</span></span></code></pre>
<p>The <code>plot</code> function can be used to display the main
components of the <code>betsite</code> analysis. It provides a composite
plot made of six elementary graphs. The main one (top-right, labeled
<code>Row scores and classes</code>) shows the row scores of the initial
data table (<code>$ls</code> data frame). The four sampling seasons for
each site are grouped with a star and an ellipse. Each star and ellipse
is labeled with the site name (<code>S1</code> to <code>S6</code>),
located at the gravity center of the star (center of the ellipse).</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">betsite</span>, row.pellipses.col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/adegraphics/man/adegpar.html" class="external-link">adegpar</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">ppalette</span><span class="op">$</span><span class="fu">quali</span><span class="op">(</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="ChapBetGr_files/figure-html/unnamed-chunk-13-1.png" width="600" height="600"></p>
<p>Plot of the <code>betsite</code> analysis. This is a composite plot
made of six graphs (see text for an explanation of the six graphs).</p>
<p>The bottom-right graph (<code>Classes</code>) shows the scores for
the groups of the Between-Class Analysis (<code>$li</code> data frame).
It contains only six points, corresponding to the six sites.</p>
<p>The following graph on the left (<code>Unconstrained axes</code>)
shows the projection of the first three axes of the initial analysis
(<code>envpca</code>) onto the Between-Class Analysis. It contains only
3 arrows, as this is the number of axes kept in the <code>envpca</code>
analysis. This graph provides a convenient way to understand the
relationships between the initial PCA that focuses on total variation
and the Between-Class Analysis. Here, we can see that the first two axes
of the simple PCA are nearly equivalent (apart from the sign) to the
first two axes of the between-site analysis.</p>
<p>The lower-left graph is labeled <code>Eigenvalues</code>; this is the
usual eigenvalues barchart. The last two graphs on the left are labeled
<code>Loadings</code> and <code>Columns</code>. They both show the ten
physico-chemical parameters, and they should be comparable. Large
differences between these two graphs would imply that the analysis is
not coherent. The first one (<code>Loadings</code>) gives the
coefficients of the linear combination that maximise the between-class
inertia (<code>$c1</code> data frame). The second one
(<code>Columns</code>) shows the scores of the variables
(<code>$co</code> data frame).</p>
<p>We can see that the first axis of the Between-Class Analysis is very
similar to the first axis of the simple PCA (pollution gradient)
indicating that the main structures (identified by PCA) are also the
main differences among groups. The factor map of row scores in the
simple PCA is very similar to the factor map of the Between-Class
Analysis, <code>Row scores and classes</code> graph). And the
correlation circle of parameters in the simple PCA is very similar to
the <code>Columns</code> graph in the between-site analysis. This is
because the between-site structure is very strong in this data set, and
the first axis of the simple PCA already identified it.</p>
<p>The <code>randtest</code> function can be used to check the
statistical significance of the differences between sites. The criterion
used in this test is the ratio of the between-class inertia to the total
inertia. The simulated <em>p</em>-value and the observed criterion can
be obtained by displaying the <code>rtbetsite</code> object. By default,
999 permutations are performed.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">rtbetsite</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/randtest.html">randtest</a></span><span class="op">(</span><span class="va">betsite</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Monte-Carlo test</span></span>
<span><span class="co">#&gt; Call: randtest.between(xtest = betsite)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Observation: 0.4412974 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Based on 999 replicates</span></span>
<span><span class="co">#&gt; Simulated p-value: 0.003 </span></span>
<span><span class="co">#&gt; Alternative hypothesis: greater </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Std.Obs Expectation    Variance </span></span>
<span><span class="co">#&gt; 3.597730158 0.216663228 0.003898472</span></span></code></pre>
<p>The observed value of the criterion is equal to 0.4413, which means
that 44% of the total inertia comes from the differences between sites.
The simulated <em>p</em>-value is equal to 0.003, which means that the
difference between sites is highly significant.</p>
<p>The following histogram shows the distribution of the values of the
criterion computed on permuted tables. The observed value for the
unpermuted table (0.4413) is plotted on the graph with a vertical bar
and a black diamond sign.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rtbetsite</span><span class="op">)</span></span></code></pre></div>
<p><img src="ChapBetGr_files/figure-html/unnamed-chunk-15-1.png" width="300" height="300"></p>
<p>Plot of the <code>rtbetsite</code> Monte-Carlo test.</p>
<p>The main characteristic of the spatial structure of physico-chemical
parameters revealed by these analyses is the pollution gradient. Site 1
is not polluted, it is located opposite of the pollution parameters
(phosphates, ammonium, oxydability, biological oxygen demand) on the
factor maps. Site 2 is the most polluted, while sites 3, 4 and 5 are
less and less polluted, as the restoration process takes place
downstream along the stream. Site 6 is a control on the Bourne river,
and it is not polluted. This particular structure is explained by the
fact that the Autrans holiday resort is located between sites 1 and 2.
The high tourist activity at this place leads to an overflow of water
treatment capacity.</p>
</div>
<div class="section level3">
<h3 id="between-season-analysis">Between-season analysis<a class="anchor" aria-label="anchor" href="#between-season-analysis"></a>
</h3>
<p>The between-season analysis gives a more interesting insight into the
<code>meau</code> data set. Indeed, the simple PCA did not provide a
very convincing picture of the seasonal structure of physico-chemical
parameters. The between-season analysis is computed using the
<code>bca</code> function, and we can check the dimension of the
<code>betseason$tab</code> data frame:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">betseason</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bca.html">bca</a></span><span class="op">(</span><span class="va">envpca</span>, <span class="va">seasons</span>, scannf <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">betseason</span><span class="op">$</span><span class="va">tab</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1]  4 10</span></span></code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">betseason</span>, row.pellipses.col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/adegraphics/man/adegpar.html" class="external-link">adegpar</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">ppalette</span><span class="op">$</span><span class="fu">quali</span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="ChapBetGr_files/figure-html/unnamed-chunk-17-1.png" width="600" height="600"></p>
<p>The generic <code>plot</code> function can be used as in the previous
section to display the main components of the <code>betseason</code>
analysis. The seasonal structure of the physico-chemical parameters is
much clearer on this figure: we see that the temperature plays a key
role in the opposition between warm (spring, summer) and cold (autumn,
winter) seasons on the second axis. The first axis is still a pollution
gradient (high levels of pollution toward the left), and opposes summer
to spring in warm seasons and autumn to winter for cold seasons. This is
easy to understand, as Autrans is a well-known summer resort, with high
tourist activity during summer holidays.</p>
<p>In the between-season analysis, the values of each parameter are
averaged across the six sites. This removes the spatial component of the
data set, and makes the seasonal structure much more apparent. Another
way to achieve the same result (underline the seasonal effect) is to
explicitly remove the spatial component using a within-site
analysis.</p>
</div>
</div>
<div class="section level2">
<h2 id="within-class-analysis-removing-differences-between-groups-of-sites">Within-Class Analysis: removing differences between groups of
sites<a class="anchor" aria-label="anchor" href="#within-class-analysis-removing-differences-between-groups-of-sites"></a>
</h2>
<p>Within-Class Analysis (Doledec 1987) is the analysis of the residuals
between observed data and group means. This means that the differences
between groups have been removed from the data set, and we are looking
for other structures remaining in the table.</p>
<p>Like in Between-Class Analysis, there is no constraint on the number
of sites compared to the number of variables, and no problem with
numerous and/or correlated variables.</p>
<p>In the <strong>ade4</strong> package, the <code>wca</code> function
is used to compute Within-Class Analysis. All the outputs of this
function are grouped in a <code>dudi</code> object (subclass
<code>within</code>).</p>
<p>The arguments of the <code>wca</code> function are the same as those
of the <code>bca</code> function: the <code>dudi</code> object, the
factor describing the groups, and the <code>scannf</code> and
<code>nf</code> usual arguments. A generic <code>plot</code> function is
also available in <strong>adegraphics</strong> to summarise the outputs
of a <code>wca</code> analysis.</p>
<p>The within-site analysis on the Méaudret data set is computed using
the <code>wca</code> function. This function calculates the residuals
between the environmental data table and the site means, and performs
the analysis on these residuals:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">witsite</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wca.html">wca</a></span><span class="op">(</span><span class="va">envpca</span>, <span class="va">sites</span>, scannf <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/s.corcircle.html">s.corcircle</a></span><span class="op">(</span><span class="va">witsite</span><span class="op">$</span><span class="va">co</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">g2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/s.class.html">s.class</a></span><span class="op">(</span><span class="va">witsite</span><span class="op">$</span><span class="va">li</span>, <span class="va">sites</span>, col <span class="op">=</span> <span class="cn">TRUE</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/adegraphics/man/ADEgS.html" class="external-link">ADEgS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">g1</span>, <span class="va">g2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="ChapBetGr_files/figure-html/unnamed-chunk-19-1.png" width="600" height="300"></p>
<p>Plot of the <code>witsite</code> analysis. Left: correlation circle
of parameter scores, right: row coordinates (grouped by sites).</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/s.class.html">s.class</a></span><span class="op">(</span><span class="va">witsite</span><span class="op">$</span><span class="va">li</span>, <span class="va">seasons</span>, col <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="ChapBetGr_files/figure-html/unnamed-chunk-20-1.png" width="600" height="600"></p>
<p>Plot of the <code>witsite</code> analysis (grouped by seasons).</p>
<p>It is easy to check that the site effect has been removed, by
plotting the row scores of the within-site analysis. This figureshows
that these row scores are centred by site (all six labels are
superimposed at the center of the graph).</p>
<p>Seasonal variations can be exposed by drawing the same row scores
(<code>witsite$li</code>), but grouped by season.</p>
<p>The same effect as in the between-season analysis is visible here,
with a seasonal effect on the second axis (spring and summer
<em>vs.</em> autumn and winter) and a pollution gradient on the first
axis (summer <em>vs.</em> spring and autumn <em>vs.</em> winter).</p>
<p>Note that the information contained in the original PCA
(<code>envpca</code>) is fully decomposed by the Between- and
Within-Class Analyses:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">envpca</span><span class="op">$</span><span class="va">eig</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 10</span></span></code></pre>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">betsite</span><span class="op">$</span><span class="va">eig</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">witsite</span><span class="op">$</span><span class="va">eig</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 10</span></span></code></pre>
<p>And the ratios provided by the analysis are simply obtained by:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">betsite</span><span class="op">$</span><span class="va">eig</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">envpca</span><span class="op">$</span><span class="va">eig</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 0.4412974</span></span></code></pre>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">witsite</span><span class="op">$</span><span class="va">eig</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">envpca</span><span class="op">$</span><span class="va">eig</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 0.5587026</span></span></code></pre>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">betsite</span><span class="op">$</span><span class="va">ratio</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 0.4412974</span></span></code></pre>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">witsite</span><span class="op">$</span><span class="va">ratio</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 0.5587026</span></span></code></pre>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">betsite</span><span class="op">$</span><span class="va">ratio</span> <span class="op">+</span> <span class="va">witsite</span><span class="op">$</span><span class="va">ratio</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 1</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="discriminant-analysis">Discriminant Analysis<a class="anchor" aria-label="anchor" href="#discriminant-analysis"></a>
</h2>
<p>The aim of Discriminant Analysis and Between-Class Analysis is the
same: highlighting the differences between groups. However, the
constraints associated to these analyses differ so that both methods do
not maximise the same criteria. Whereas Between-Class Analysis maximises
the between-class inertia, Discriminant Analysis maximises the
between-class inertia relative to the total inertia.</p>
<p>The <code>discrimin</code> function of the <strong>ade4</strong>
package is used to compute a Discriminant Analysis. All the outputs of
this function are grouped in a <code>discrimin</code> object. The
arguments of the <code>discrimin</code> function are the same as those
of the <code>bca</code> function: the first argument is the
<code>dudi</code> object corresponding to the preparatory analysis of
the data table. The second argument is a factor describing the groups of
rows. The last two arguments (<code>scannf</code> and <code>nf</code>)
have the same meaning as in the other analysis functions.</p>
<p>Discriminant Analysis is applied to study the seasonal structure of
physico-chemical parameters:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">discseason</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/discrimin.html">discrimin</a></span><span class="op">(</span><span class="va">envpca</span>, <span class="va">seasons</span>, scannf <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">discseason</span>, row.pellipses.col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/adegraphics/man/adegpar.html" class="external-link">adegpar</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">ppalette</span><span class="op">$</span><span class="fu">quali</span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="ChapBetGr_files/figure-html/unnamed-chunk-24-1.png" width="600" height="600"></p>
<p>The <code>plot</code> function can be used to display the main
components of the <code>discseason</code> analysis. It provides a
composite plot made of six elementary graphs. The main one (top-right,
labeled <code>Row scores and classes</code>) shows the projections of
the sites onto the plane defined by the axes of the Discriminant
Analysis (<code>$li</code> data frame). The six sampling sites for each
season are grouped with a star and an ellipse. Each star and ellipse is
labeled with the season name, located at the gravity center of the star
(center of the ellipse). The bottom-right graph
(<code>Class scores</code>) shows the group scores (<code>$gc</code>
data frame). It contains only four points, corresponding to the four
seasons. The following graph on the left
(<code>Unconstrained axes</code>) shows the projection of the axes of
the initial Principal Component Analysis (<code>$cp</code> data frame)
to understand the relationships between the initial PCA and the
Discriminant Analysis. Here, we can see that the third axis of the
simple PCA - temperature - is equivalent (apart from the sign) to the
first axis of the Discriminant Analysis. The lower-left graph
(<code>Eigenvalues</code>) is the usual eigenvalues barchart. The last
two graphs on the left are labeled <code>Loadings</code> and
<code>Columns</code>. The first one represents the coefficients of the
variables (<code>$fa</code> data frame). The second one represents the
covariances between the ten physico-chemical parameters
(<code>$va</code> data frame) and the axes of the analysis.</p>
<p>The first axis of the Discriminant Analysis is linked to the water
temperature and the second axis to the flow. The seasons define a strong
structure where the pollution component disappeared.</p>
<p>The <code>randtest</code> function can be used to check the
statistical significance of the differences between seasons. The
criterion used in this test is the ratio of the between-class inertia to
the total inertia. The simulated <em>p</em>-value and the observed
criterion can be obtained by displaying the <code>rtdiscseason</code>
object. By default, 999 permutations are performed.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">rtdiscseason</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/randtest.html">randtest</a></span><span class="op">(</span><span class="va">discseason</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Monte-Carlo test</span></span>
<span><span class="co">#&gt; Call: randtest.discrimin(xtest = discseason)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Observation: 0.2551751 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Based on 999 replicates</span></span>
<span><span class="co">#&gt; Simulated p-value: 0.001 </span></span>
<span><span class="co">#&gt; Alternative hypothesis: greater </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      Std.Obs  Expectation     Variance </span></span>
<span><span class="co">#&gt; 5.6640561216 0.1302597718 0.0004863804</span></span></code></pre>
<p>The observed value of the criterion is equal to 0.2552, which means
that 26% of the total inertia comes from the differences between
seasons. The simulated <em>p</em>-value is equal to 0.001, which means
that the difference between seasons is highly significant.</p>
<p>The histogram shows the distribution of the values of the criterion
computed on permuted tables. The observed value for the unpermuted table
(0.2552) is plotted on the graph with a vertical bar and a black diamond
sign.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rtdiscseason</span><span class="op">)</span></span></code></pre></div>
<p><img src="ChapBetGr_files/figure-html/unnamed-chunk-26-1.png" width="300" height="300"></p>
<p>Plot of the <code>rtdiscseason</code> Monte-Carlo test.</p>
<p>The main characteristic of the temporal structure of physico-chemical
parameters revealed by this analysis is the water cycle, the pollution
gradient is eliminated.</p>
<p>Between-Class Analyses and Discriminant Analyses highlight
differences between groups of observations but are not based on the same
constraints. This implies that Between-Class Analysis maximises the
between-class inertia whereas Discriminant Analysis maximises the
between-class inertia relative to the total inertia. This theoretical
difference has important practical implications. Between-Class Analyses
can work on tables with few individuals compared to the number of
variables and is able to deal with collinearities among variables. On
the other hand, Discriminant Analysis requires a high number of
individuals compared to the number of variables. An another important
difference is illustrated by the <code>Row scores and classes</code>
graph of the between-season analysis. On this plot, all the seasons
present an elongated ellipse associated to the pollution gradient kept
on the first axis of the analysis. Hence, BCA maximises the distance
between the centers of the ellipses (i.e., the between-class inertia)
but does not control for the size of the ellipses (i.e., the total
inertia). On the other hand, Discriminant Analysis, tries to maximise
the between-class inertia while minimising the total inertia. In the
<code>Row scores and classes</code> graph of the Discriminant Analysis,
the ellipses of seasons are thus much smaller. All the sites gathered to
the gravity center of the seasons, highlighting the seasonal cycle.</p>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>The main structure of the <code>meau</code> data set is the spatial
structure of the pollution along the six sites. There is a strong
pollution peak between sites 1 and 2, and the restoration process takes
place downstream along sites 3, 4 and 5. The simple PCA of the data
table shows this spatial structure very clearly and it can be
interpreted using the contributions of the 10 physico-chemical
parameters. The between-site analysis does not bring much more
information.</p>
<p>There is also a strong seasonal structure, which is not very clearly
taken into account by the simple PCA. This structure opposes warm and
cold seasons. In the warm season, pollution is lower in spring than in
summer because stream flow is higher in spring and pollutants are more
diluted. Moreover, tourism is much higher in summer, which still
increases pollution. In the cold season, pollution is higher in autumn
because stream flow is at its minimum, so the concentration of
pollutants is maximum, although most tourists have gone. This structure
is adequately revealed by both the between-season analysis and the
within-site analysis. However, this pollution structure disappeared in
the Discriminant Analysis because of the supplementary constraint on the
physico-chemical variables keeping only the water cycle (temperature and
flow).</p>
<p>These analyses work differently. The between-season and discriminant
analyses compute the mean of each parameter among the six sites, so that
the spatial effect is removed and the seasonal effect is revealed. The
within-site analysis computes the residuals between the raw data table
and the spatial model (means by site), thus removing the spatial effect
and revealing the seasonal effect.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Stéphane Dray, Anne-Béatrice Dufour, Jean Thioulouse, Aurélie Siberchicot.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
